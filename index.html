<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat App</title>
<style>
:root {
  --dark-bg:#000; --dark-text:#0f0;
  --light-bg:#fff; --light-text:#00f;
}
body{margin:0;font-family:Arial,sans-serif;transition:background 0.3s,color 0.3s;}
body.dark{background:var(--dark-bg);color:var(--dark-text);}
body.light{background:var(--light-bg);color:var(--light-text);}
header{display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #555;}
#theme-toggle{cursor:pointer;padding:5px;transition:0.3s;}
#theme-toggle:hover{transform:scale(1.1);}
#notification{position:relative;cursor:pointer;margin-right:10px;}
#notification img{width:24px;transition:transform 0.2s;}
#notification img:hover{transform:scale(1.2);}
#notification span{position:absolute;top:-5px;right:-5px;background:red;color:#fff;font-size:12px;border-radius:50%;padding:2px 5px;}
#chat{display:flex;flex-direction:column;height:calc(100vh - 50px);}
#messages{flex:1;overflow-y:auto;padding:10px;}
.message{margin:5px 0;padding:5px 10px;border-radius:5px;animation:slideFade 0.3s ease;}
.user-nick{font-weight:bold;cursor:pointer;transition:color 0.3s;}
.user-nick:hover{opacity:0.7;}
#input-area{display:flex;border-top:1px solid #555;}
#input-area input{flex:1;padding:10px;border:none;outline:none;font-size:16px;}
#input-area button{padding:10px 15px;border:none;cursor:pointer;background:#0f0;color:#000;font-weight:bold;transition:background 0.3s,transform 0.2s;}
#input-area button:hover{background:#0c0;transform:scale(1.05);}
@keyframes slideFade{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
#private-chat{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:inherit;color:inherit;flex-direction:column;z-index:100;animation:fadeInScale 0.3s ease;}
#private-chat.show{display:flex;}
@keyframes fadeInScale{from{opacity:0;transform:scale(0.95);}to{opacity:1;transform:scale(1);}}
#private-chat .header{display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid #555;}
#private-chat #private-messages{flex:1;overflow-y:auto;padding:10px;}
#private-chat #private-input-area{display:flex;border-top:1px solid #555;}
#private-chat #private-input-area input{flex:1;padding:10px;border:none;outline:none;font-size:16px;}
#private-chat #private-input-area button{padding:10px 15px;border:none;cursor:pointer;background:#0f0;color:#000;font-weight:bold;transition:background 0.3s,transform 0.2s;}
#private-chat #private-input-area button:hover{background:#0c0;transform:scale(1.05);}
@media(max-width:600px){
  #input-area input, #private-input-area input{font-size:14px;}
  #input-area button, #private-chat #private-input-area button{padding:8px 12px;font-size:14px;}
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∏–∫–∞ */
#login-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:200;}
#login-box{background:#222;color:#0f0;padding:20px;border-radius:10px;min-width:250px;text-align:center;}
#login-box input{width:100%;padding:8px;margin:5px 0;font-size:14px;}
#login-box button{width:100%;padding:8px;margin:5px 0;background:#0f0;color:#000;font-weight:bold;border:none;cursor:pointer;transition:0.3s;}
#login-box button:hover{background:#0c0;}
</style>
</head>
<body class="dark">

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–ª—å–∫–æ —Å –Ω–∏–∫–æ–º -->
<div id="login-modal">
  <div id="login-box">
    <h3>–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫</h3>
    <input id="nick-input" placeholder="–í–∞—à –Ω–∏–∫">
    <button id="login-btn">–í–æ–π—Ç–∏</button>
    <div id="login-msg" style="color:red;font-size:12px;"></div>
  </div>
</div>

<header>
  <div>–û–±—â–∏–π —á–∞—Ç</div>
  <div style="display:flex;align-items:center;">
    <span id="notification"><img src="https://cdn-icons-png.flaticon.com/512/1827/1827343.png"><span id="notif-count">0</span></span>
    <button id="theme-toggle">üåó</button>
  </div>
</header>
<div id="chat">
  <div id="messages"></div>
  <div id="input-area">
    <input id="msg-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<div id="private-chat">
  <div class="header">
    <div id="private-nick"></div>
    <button id="close-private">‚úñ</button>
  </div>
  <div id="private-messages"></div>
  <div id="private-input-area">
    <input id="private-input" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ...">
    <button id="private-send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let nick = "";

// –°–ª—É—á–∞–π–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –Ω–∏–∫–æ–≤
const colors=['#e6194b','#3cb44b','#ffe119','#4363d8','#f58231','#911eb4','#46f0f0','#f032e6'];
function getColor(n){let hash=0;for(let i=0;i<n.length;i++){hash=n.charCodeAt(i)+((hash<<5)-hash);}return colors[Math.abs(hash)%colors.length];}

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const messages=document.getElementById('messages');
const input=document.getElementById('msg-input');
const sendBtn=document.getElementById('send-btn');
const notifCount=document.getElementById('notif-count');
let unread=0;

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
const privateChat=document.getElementById('private-chat');
const privateNick=document.getElementById('private-nick');
const privateMessages=document.getElementById('private-messages');
const privateInput=document.getElementById('private-input');
const privateSend=document.getElementById('private-send');
const closePrivate=document.getElementById('close-private');

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–∏–∫–∞
const loginModal=document.getElementById('login-modal');
const nickInput=document.getElementById('nick-input');
const loginBtn=document.getElementById('login-btn');
const loginMsg=document.getElementById('login-msg');

loginBtn.onclick=()=>{
  const n = nickInput.value.trim();
  if(n.length<1){ loginMsg.textContent="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫"; return; }
  nick = n;
  socket.emit('login',{nick});
  loginModal.style.display='none';
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
sendBtn.onclick=()=>{if(input.value.trim()!==''){socket.emit('message',input.value);input.value='';}}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
socket.on('chat',({nick:n,msg})=>{
  const div=document.createElement('div');
  div.className='message';
  div.innerHTML=<span class="user-nick" style="color:${getColor(n)}">${n}</span>: ${msg};
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
  if(document.hidden){unread++; notifCount.textContent=unread;}
});

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
document.addEventListener('visibilitychange',()=>{if(!document.hidden){unread=0; notifCount.textContent=0;}});

// –¢–µ–º–Ω–∞—è/—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞
document.getElementById('theme-toggle').onclick=()=>{document.body.classList.toggle('dark');document.body.classList.toggle('light');}

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
messages.addEventListener('click',e=>{
  if(e.target.classList.contains('user-nick')){
    privateNick.textContent=e.target.textContent;
    privateChat.classList.add('show');
    privateMessages.innerHTML='';
  }
});
closePrivate.onclick=()=>{privateChat.classList.remove('show');}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
privateSend.onclick=()=>{
  if(privateInput.value.trim()!==''){
    socket.emit('private',{to:privateNick.textContent,msg:privateInput.value});
    const div=document.createElement('div');
    div.className='message';
    div.innerHTML=<span class="user-nick" style="color:${getColor(nick)}">–Ø</span>: ${privateInput.value};
    privateMessages.appendChild(div);
    privateMessages.scrollTop = privateMessages.scrollHeight;
    privateInput.value='';
  }
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
socket.on('private',({from,msg})=>{
  if(privateChat.classList.contains('show') && privateNick.textContent===from){
    const div=document.createElement('div');
    div.className='message';
    div.innerHTML=<span class="user-nick" style="color:${getColor(from)}">${from}</span>: ${msg};
privateMessages.appendChild(div);
    privateMessages.scrollTop = privateMessages.scrollHeight;
  }else{
    unread++; notifCount.textContent=unread;
    const audio=new Audio("https://www.myinstants.com/media/sounds/bell.mp3");
    audio.play().catch(()=>{});
  }
});
</script>
</body>
</html>
