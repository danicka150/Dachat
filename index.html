<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dachat</title>
<style>
body {
  margin:0;
  font-family:monospace;
  background:#0a0a0a;
  color:#00ff66;
  height:100vh;
  display:flex;
  flex-direction:column;
}
body.light {background:#f0f8ff;color:#003366;}

#login {margin:auto;text-align:center;}
input {background:#111;border:1px solid #00ff66;color:#00ff66;margin:5px;padding:10px;border-radius:5px;width:90%;max-width:300px;font-size:16px;}
button {background:#00ff66;color:#000;border:none;padding:10px 20px;cursor:pointer;border-radius:5px;font-size:16px;}

#chat,#privateChat{display:none;flex-direction:column;flex:1;overflow:hidden;}
#messages,#privateMessages{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;}
.msg{margin-bottom:8px;word-wrap:break-word;opacity:0;transform:translateY(20px);animation:slideIn 0.3s forwards;}
.msg.self{align-self:flex-end;color:#000;background:#00ff66;padding:8px 12px;border-radius:12px;}
.msg.other{align-self:flex-start;color:#00ff66;background:#111;padding:8px 12px;border-radius:12px;}
.msg .nick{font-weight:bold;cursor:pointer;text-decoration:underline;}
@keyframes slideIn{to{opacity:1;transform:translateY(0);}}

form{display:flex;padding:8px;border-top:1px solid #00ff66;background:#111;}
#msgChat,#msgPrivate{flex:1;padding:10px;border-radius:8px;border:1px solid #00ff66;background:#111;color:#00ff66;font-size:16px;}
form button{margin-left:8px;padding:10px 16px;font-size:16px;border-radius:8px;}

#privateHeader{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#111;border-bottom:1px solid #00ff66;font-weight:bold;}
#privateHeader button{background:none;border:none;color:#ff4444;font-size:18px;cursor:pointer;}

#themeToggle, #notifBell {
  position:fixed;top:10px;padding:8px 10px;border:none;border-radius:5px;font-size:18px;cursor:pointer;z-index:10;
}
#themeToggle {right:10px;background:#00ff66;color:#000;}
#notifBell {right:60px;background:#111;color:#00ff66;}
#notifCount {position:absolute;top:-5px;right:-5px;background:#ff4444;color:#fff;font-size:12px;font-weight:bold;border-radius:50%;width:18px;height:18px;display:flex;align-items:center;justify-content:center;pointer-events:none;}

@media(max-width:600px){
  #themeToggle, #notifBell {
    top:50px;  /* –≤—ã—à–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å */
    right:10px;
  }
  #notifBell { right:60px; }
}
</style>
</head>
<body>

<button id="themeToggle">üåó</button>
<button id="notifBell">üîî
  <div id="notifCount" style="display:none">0</div>
</button>

<div id="login">
<h2>–í—Ö–æ–¥ –≤ —á–∞—Ç</h2>
<input id="nick" placeholder="–ù–∏–∫"><br>
<input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å"><br>
<button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div id="chat">
<div id="messages"></div>
<form onsubmit="sendChat(event)">
<input id="msgChat" autocomplete="off" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
<button>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>
</div>

<div id="privateChat">
<div id="privateHeader">
<span id="privateWith"></span>
<button onclick="closePrivate()">‚ùå</button>
</div>
<div id="privateMessages"></div>
<form onsubmit="sendPrivate(event)">
<input id="msgPrivate" autocomplete="off" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
<button>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</form>
</div>

<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<script>
const socket = io();
let nick = null;
let privateTo = null;
let unread = 0;
const userColors = {};

const notifCount = document.getElementById('notifCount');
const bell = document.getElementById('notifBell');
function increaseNotif(){unread++;notifCount.style.display='flex';notifCount.textContent=unread;}
function resetNotif(){unread=0;notifCount.style.display='none';}
bell.onclick=()=>{
  privateTo=null;
  document.getElementById('privateChat').style.display='none';
  document.getElementById('chat').style.display='flex';
  resetNotif();
};
// –¶–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
function getUserColor(name){
  if(name===nick) return '#00ff66';
  if(!userColors[name]){
    const letters='0123456789ABCDEF'; let color='#';
    for(let i=0;i<6;i++) color+=letters[Math.floor(Math.random()*16)];
    userColors[name]=color;
  }
  return userColors[name];
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
function addMessage(text,cls,user,container){
  const div=document.createElement('div');
  div.className='msg '+cls;
  div.innerHTML=text;
  container.appendChild(div);
  container.scrollTop=container.scrollHeight;
}

// –õ–æ–≥–∏–Ω
function login(){
  nick = document.getElementById('nick').value.trim();
  const pass = document.getElementById('pass').value.trim();
  if(!nick) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫');
  socket.emit('login',{nick,nick,pass});
  document.getElementById('login').style.display='none';
  document.getElementById('chat').style.display='flex';
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ–±—â–µ–≥–æ —á–∞—Ç–∞
function sendChat(e){
  e.preventDefault();
  const msgInput=document.getElementById('msgChat');
  const msg=msgInput.value.trim();
  if(!msg) return;
  socket.emit('message',msg);
  addMessage('<span class="nick">'+nick+'</span>: '+msg,'self',nick,document.getElementById('messages'));
  msgInput.value='';
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –õ–°
function sendPrivate(e){
  e.preventDefault();
  if(!privateTo) return;
  const msgInput=document.getElementById('msgPrivate');
  const msg=msgInput.value.trim();
  if(!msg) return;
  socket.emit('private',{to:privateTo,msg});
  addMessage('–í—ã: '+msg,'self',null,document.getElementById('privateMessages'));
  msgInput.value='';
}

// –õ–°
function openPrivate(name){
  privateTo=name;
  document.getElementById('privateWith').textContent=name;
  document.getElementById('privateMessages').innerHTML='';
  document.getElementById('chat').style.display='none';
  document.getElementById('privateChat').style.display='flex';
  resetNotif();
}
function closePrivate(){
  privateTo=null;
  document.getElementById('privateChat').style.display='none';
  document.getElementById('chat').style.display='flex';
  resetNotif();
}

// –¢–µ–º–∞
document.getElementById('themeToggle').onclick=()=>{document.body.classList.toggle('light');};

// Socket.IO —Å–æ–±—ã—Ç–∏—è
socket.on('chat',({nick:userNick,msg})=>{
  const container=document.getElementById('messages');
  const cls=userNick===nick?'self':'other';
  addMessage('<span class="nick" onclick="openPrivate(\''+userNick+'\')">'+userNick+'</span>: '+msg,cls,userNick,container);
  if(!privateTo && userNick!==nick) increaseNotif();
});
socket.on('private',({from,msg})=>{
  if(privateTo===from){
    addMessage(from+': '+msg,'other',from,document.getElementById('privateMessages'));
  }else{
    addMessage('üîí –õ–° –æ—Ç <span class="nick" onclick="openPrivate(\''+from+'\')">'+from+'</span>: '+msg,'other',from,document.getElementById('messages'));
    increaseNotif();
  }
});
socket.on('system',text=>{
  addMessage('‚öôÔ∏è '+text,'other',null,document.getElementById('messages'));
});
</script>
</body>
</html>
